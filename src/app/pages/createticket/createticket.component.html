<div class="container">
    @if (role=='Department Head') {
        <div class="row">
            <div class="col-2">
 <button class="btn btn-info m-1" (click)="getalltickdepthead(empid)">Get All Record</button>
</div>
<div class="col-2">
    <button class="btn btn-info m-1" (click)="getnewticket(empid)">Get New Record</button>   
</div>
        </div>
    }
   @if (role==='Employee'||role==='Admin Department Employee'||role==='Department Head') {
    <div class="card">
        <div class="card-heading bg-secondary text-white text-center">
            Ticket Information
            @if (role=='Employee') {
            <button class="btn addbtn btn-info text-white text-end" data-bs-toggle="modal" data-bs-target="#ticketform" (click)="ShowSavebtn()">Add New Ticket</button>
        }
        </div>
    <div class="row">
        @if (role=='Employee') {
        <div class="col-12">
            <table class="table table-bordered">
                <thead>
                    <tr>
                    <th>Create Date</th>
                    <th>Expected End Date</th>
                    @if (ticketList && ticketList.length>0 && ticketList[0].deptName) {
                    <th>Department</th>
                }
                    <th>State</th>
                    <th>Ticket No</th>
                    <th>Created Employee</th>
                    <!-- @if (role == 'Admin Department Employee') { -->
                    <th>Request Details</th>
                <!-- } -->
                    <th>Action</th>
                </tr>
                </thead>
                @if (ticketList && ticketList.length>0) {
                <tbody>
                    @for (ticket of ticketList; track ticket.ticketId) {
                     <tr>
                        <td>{{ticket.createdDate|date}}</td>
                        <td>{{ticket.expectedEndDate|date}}</td>
                        @if (ticket.deptName) {
                        <td>{{ticket.deptName}}</td>
                    }
                    <td>
                        <!-- @if (role==='Department Head') { -->
                        <ng-container>
                            @if (ticket.state=='Un-Assigned') {
                            <ng-container>{{ticket.state}}</ng-container>
                        }
                        <ng-template #assigned>{{ticket.assignedToEmployee}}</ng-template>
                        @if (ticket.state=='Un-Assigned') {
                            <button  class="btn btn-success" (click)="assignTicket(ticket.ticketId)" (click)="showassignform()">Assign</button>
                        }
                        </ng-container>
                    <!-- } -->
                    @if (role=='Employee'||role=='Admin Department Employee') {
                        <ng-container >{{ticket.state}}</ng-container>
                    }
                    </td>
                        <td>{{ticket.ticketNo}}</td>
                        <td>{{ticket.createdByEmployee||ticket.employeeName}}</td>
                        <!-- @if (role==='Admin Department Employee') { -->
                        <td>{{ticket.requesDetails}}</td>
                    <!-- } -->
                        <td>
                            <!-- @if (role==='Admin Department Employee') { -->
                                <div>
                                @if (ticket.state=='Assigned') {
                            <button class="btn btn-success" (click)="startTicket(ticket.ticketId)">Start Ticket</button>
                        }
                        @if (ticket.state=='In-Progress') {
                            <button class="btn btn-danger" (click)="closeticket(ticket.ticketId)">Close Ticket</button>
                        }
                    </div>
                        <!-- } -->
                         @if (role=='Employee'||role=='Department Head') {
                            <i class="fa-solid fa-trash bg-danger m-1 text-white p-2" (click)="onDelete(ticket)"></i>
                        }
                        </td>
                     </tr>
                    }
                </tbody>
            }
            </table>
            <ng-template #noRecords>
                <tr>
                    <td colspan="8">
                        <div class="alert alert-info text-center" role="alert">
                            No records found.
                        </div>
                    </td>
                </tr>
            </ng-template>
        </div>
    }
    </div>
</div>
}



<div class="modal" id="ticketform">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-secondary text-white text-center">
            <strong>Add Ticket</strong>
            <i class="fa-regular fa-circle-xmark rounded bg-danger text-white close" data-bs-dismiss="modal"></i>
        </div>
        <div class="modal-body">
<form #form="ngForm">
    <div class="row">
        <!-- <div class="col-12">
            <label for="">Employee Name</label><br>
            <select class="form-control" name="emp" [(ngModel)]="createticketobj.employeeId">
            <option value="0" selected>Select Employee</option>
            @for (emp of empList; track $index) {
            <option [value]="emp.employeeId">{{emp.employeeName}}</option>
        }
            </select>
        </div> -->
        <div class="col-12">
            <label for="">Saverity</label>
           <select class="form-control" name="saverity" [(ngModel)]="createticketobj.severity">
          <option value="0" selected>Select Saverity</option>
          <option>Low</option>
          <option>Medium</option>
          <option>High</option>
           </select>
        </div>
            <div class="col-12">
                <label for="">Department</label>
                <select class="form-control" name="dept" [(ngModel)]="createticketobj.deptId">
                    <option value="0" selected>Select Department</option>
                   @for (dept of deptList; track $index) {
                    <option [value]="dept.deptId">{{dept.deptName}}</option>
                   }
                </select>
            </div>
            <!-- <div class="col-12">
                <label for="">State</label>
                <input type="text" class="form-control" name="state" #state="ngModel" [(ngModel)]="createticketobj.state" required>
                @if (state.touched||state.dirty) {
                    <div class="text-danger">
                        @if (state.errors) {
                            <span>Enter State</span>
                        }
                    </div>
                }
            </div> -->
            <div class="col-12">
                <label for="">RequestDetails</label>
                <input type="text" class="form-control" name="reqdetail" #reqdetail="ngModel" [(ngModel)]="createticketobj.requestDetails" required>
                @if (reqdetail.touched||reqdetail.dirty) {
                    <div class="text-danger">
                        @if (reqdetail.errors) {
                            <span>Enter Request Details</span>
                        }
                    </div>
                }
            </div>
            
    </div>
</form>
</div>
<div class="modal-footer">
    <div class="col-12">
        @if (savebtn==true) {
        <button class="btn btn-success m-1" (click)="createTicket()">CreateTicket</button>
    }
        <button class="btn btn-danger" (click)="reset()">Reset</button>
    </div>
</div>
</div>
</div>
</div>

<div class="modal" id="assignform">
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header bg-secondary text-white">
            Assign Ticket
            <i class="fa-regular fa-circle-xmark rounded bg-danger text-white close" data-bs-dismiss="modal"></i>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-12">
                <label for="">Assign To</label><br>
                <select name="assignto" [(ngModel)]="assigntickobj.assignedTo">
                <option value="0" selected>Select Employee</option>
                @for (emp of empList; track $index) {
                    <!-- <ng-container> -->
               <option  [value]="emp.employeeId">{{emp.employeeName}}</option>
                }
            <!-- </ng-container> -->
                </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" (click)="assignreq()">Assign</button>
        </div>
    </div>
</div>
</div>
</div>